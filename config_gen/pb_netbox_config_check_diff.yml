---

- name: Create config using hostvars from Netbox and Jinja2 template
  connection: network_cli
  hosts: SW01
  gather_facts: false

  tasks:
    - name: "Generate configs using data obtained from netbox"
      template:
        src: "./templates/{{ device_roles[0] }}.j2"
        dest: "./output/{{ inventory_hostname }}.cfg"
        lstrip_blocks: true
    - name: check the running-config against master config
      cisco.ios.ios_config:
        diff_against: intended
        intended_config: "{{ lookup('file', './output/{{ inventory_hostname }}.cfg') }}"
